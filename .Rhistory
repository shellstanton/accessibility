getwd()
knitr::opts_chunk$set(echo = TRUE)
library(sf)
#remotes::install_github("r-spatial/rgee")
library(rgee)
library(mapview)
library(googledrive)
library(osmdata)
library(ggplot2)
library(raster)
library(gdistance)
library(ggplot2)
library(fasterize)
bbxmin <- 33.2
bbxmax <- 33.8
bbymin <- -11.29
bbymax <- -10.73
aoi_bbox = c(bbxmin, bbymin, bbxmax, bbymax)
q <- opq(bbox = aoi_bbox) %>%
add_osm_feature(key = 'highway') %>%
osmdata_sf()
ggplot(q$osm_lines)+geom_sf()
# Temporarily read in NDVI from folder, downloaded from GEE
ndvipath <- "./data/NDVIexample.tif")
# Temporarily read in NDVI from folder, downloaded from GEE
ndvipath <- "./data/NDVIexample.tif"
ndvi <- raster(ndvipath)
# Reclassify so that <0.35 = impassable, 0.35-0.6 = 3.5km/h, 0.6-0.7 = 2.48km/h and > 0.7 = 1.49km/h
ndviwalk_kph <- c(0.1, 3.5,  2.48, 1.49)
# Convert to m/s
ndviwalk_mps <- ndviwalk_kph/3.6
# Convert to crossing time in seconds, assuming travel along hypotenuse and pixel size is 30m
ndviwalk_secs <- 42.43/ndviwalk_mps
# Convert km/h to m/s
ndviwalk_vec <- c(-1, 0.35, ndviwalk_secs[1], 0.35, 0.6, ndviwalk_secs[2], 0.6, 0.7, ndviwalk_secs[3], 0.7, 1, ndviwalk_secs[4])
ndviwalk_mat <- matrix(ndviwalk_vec, ncol = 3, byrow = TRUE)
ndvi_assigned <- ndvi
ndvi_assigned <- reclassify(ndvi_assigned, ndviwalk_mat)
## load required packages, and install packages which are potentially missing on client computers
list.of.packages <- c("sf", "mapview", "googledrive", "osmdata", "ggplot2", "raster", "gdistance", "fasterize", "remotes", "rgdal", "stars", "geojsonio")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, library, character.only = TRUE)
## install rgee from github
remotes::install_github("r-spatial/rgee")
library(rgee)
ee_install()
knitr::opts_chunk$set(echo = TRUE)
## load required packages, and install packages which are potentially missing on client computers
list.of.packages <- c("sf", "mapview", "googledrive", "osmdata", "ggplot2", "raster", "gdistance", "fasterize", "remotes", "rgdal", "stars", "geojsonio")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, library, character.only = TRUE)
## install rgee from github
#remotes::install_github("r-spatial/rgee")
library(rgee)
ee_Initialize(drive = TRUE)
bbxmin <- 33.2
bbxmax <- 33.8
bbymin <- -11.29
bbymax <- -10.73
aoi <- ee$Geometry$Polygon(coords=list(c(bbxmin, -bbymax), c(bbxmax, bbymax), c(bbxmax, bbymin), c(bbxmin, -bbymin)))
ls8 <- ee$ImageCollection("LANDSAT/LC08/C01/T1_RT_TOA")
spatialFiltered <- ls8$filterBounds(aoi)
temporalFiltered <- spatialFiltered$filterDate('2018-06-01', '2018-09-30')
ndvilowcloud <- function(image) {
# Get a cloud score in [0, 100].
cloud <- ee$Algorithms$Landsat$simpleCloudScore(image)$select('cloud')
# Create a mask of cloudy pixels from an arbitrary threshold (20%).
mask <- cloud$lte(20)
# Compute NDVI using inbuilt function
ndvi <- image$normalizedDifference(c('B5', 'B4'))$rename('NDVI')
# Return the masked image with an NDVI band.
image$addBands(ndvi)$updateMask(mask)
}
cloudlessNDVI = temporalFiltered$map(ndvilowcloud)
medianimage <- cloudlessNDVI$median()$select('NDVI')
medNDVIaoi <- medianimage$clip(aoi)
Map$centerObject(aoi)
Map$addLayer(
eeObject=medNDVIaoi,
visParam=list(min=-1, max=1, palette=c('blue', 'white', 'green')),
name="Median NDVI"
)
medNDVIaoi
Map$centerObject(aoi)
Map$addLayer(
eeObject=medNDVIaoi)
Map$centerObject(aoi)
Map$addLayer(
eeObject=medianimage)
aoi
medNDVIaoi <- medianimage$clip(aoi)
Map$addLayer(
eeObject=medNDVIaoi,
visParam=list(min=-1, max=1, palette=c('blue', 'white', 'green')),
name="Median NDVI"
)
Map$centerObject(aoi)
Map$addLayer(
eeObject=medianimage)
aoi <- ee$Geometry$Polygon(coords=list(c(bbxmin, -bbymax), c(bbxmax, bbymax), c(bbxmax, bbymin), c(bbxmin, -bbymin)))
knitr::opts_chunk$set(echo = TRUE)
bbxmin <- 33.2
bbxmax <- 33.8
bbymin <- -11.29
bbymax <- -10.73
aoi <- ee$Geometry$Polygon(coords=list(c(bbxmin, -bbymax), c(bbxmax, bbymax), c(bbxmax, bbymin), c(bbxmin, -bbymin)))
## load required packages, and install packages which are potentially missing on client computers
list.of.packages <- c("sf", "mapview", "googledrive", "osmdata", "ggplot2", "raster", "gdistance", "fasterize", "remotes", "rgdal", "stars", "geojsonio")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, library, character.only = TRUE)
## install rgee from github
#remotes::install_github("r-spatial/rgee")
library(rgee)
aoi <- ee$Geometry$Polygon(coords=list(c(bbxmin, -bbymax), c(bbxmax, bbymax), c(bbxmax, bbymin), c(bbxmin, -bbymin)))
ee_Initialize(drive = TRUE)
ee_install()
ee_clean_pyenv()
knitr::opts_chunk$set(echo = TRUE)
## load required packages, and install packages which are potentially missing on client computers
list.of.packages <- c("sf", "mapview", "googledrive", "osmdata", "ggplot2", "raster", "gdistance", "fasterize", "remotes", "rgdal", "stars", "geojsonio")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, library, character.only = TRUE)
## install rgee from github
#remotes::install_github("r-spatial/rgee")
library(rgee)
ee_install()
## load required packages, and install packages which are potentially missing on client computers
list.of.packages <- c("sf", "mapview", "googledrive", "osmdata", "ggplot2", "raster", "gdistance", "fasterize", "remotes", "rgdal", "stars", "geojsonio")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
## install rgee from github
#remotes::install_github("r-spatial/rgee")
library(rgee)
ee_install()
knitr::opts_chunk$set(echo = TRUE)
## load required packages, and install packages which are potentially missing on client computers
list.of.packages <- c("sf", "mapview", "googledrive", "osmdata", "ggplot2", "raster", "gdistance", "fasterize", "remotes", "rgdal", "stars", "geojsonio")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, library, character.only = TRUE)
## install rgee from github
#remotes::install_github("r-spatial/rgee")
library(rgee)
bbxmin <- 33.2
bbxmax <- 33.8
bbymin <- -11.29
bbymax <- -10.73
aoi <- ee$Geometry$Polygon(coords=list(c(bbxmin, -bbymax), c(bbxmax, bbymax), c(bbxmax, bbymin), c(bbxmin, -bbymin)))
ee_Initialize(drive = TRUE)
ee_Initialize(drive = TRUE)
